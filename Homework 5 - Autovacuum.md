# MVCC, vacuum и autovacuum.  Настройка autovacuum с учетом особеностей производительности
### Создать инстанс ВМ с 2 ядрами и 4 Гб ОЗУ и SSD 10GB

Для выполнения ДЗ будем использовать **VirtualBox** и образ **Ubuntu 22.04 LTS**, они доступны бесплатно по первой ссылке в гугле.  
Для запуска ОС потребуется:  
1. Скачать образ Ubuntu 22.04.4 LTS отсюда: https://ubuntu.com/download/desktop  
2. Установить VirtualBox отсюда: https://www.virtualbox.org/wiki/Downloads  
3. Открыть VirtualBox  
4. Нажать в главном меню Машина > Создать  
5. Открыть раздел "Имя и тип ОС"  
5.1. В выпадающем списке "Образ ISO" выбрать "Другой" и указать скачанный ранее iso-образ  
5.2. В выпадающем списке "Тип" выбрать "Linux"  
5.3. В выпадающем списке "Версия" выбрать "Ubuntu 22.04 LTS (Jammy Jellyfish) (64-bit)"  
5.4. В поле "Имя" ввести любое имя  
6. Открыть раздел "Автоматическая установка"  
6.1. В поле "Имя хоста" указать любое корректное имя без пробелов  
6.2. В полях "Пароль" и "Подтвердите пароль" задать пароль, либо нажать на глаз и запомнить пароль, который там был  
7. Открыть раздел "Оборудование"  
7.1 Выбрать Основную память 8192 МБ  
7.2 Выбрать 4 процессора  
8. Нажать кнопку "Готово"  
9. Подождать, пока установится ОС  
10. Пропустить все вопросы, связанные с настройкой, после запуска ОС  
11. Терминал при этом не открывается, поэтому нужно зайти в Settings > Region > Language > Login Screen > явным образом выбрать English (United States) без ISO-8859-1 и перезагрузить ОС (см. https://ru.stackoverflow.com/questions/1476869/%D0%9D%D0%B5-%D0%BC%D0%BE%D0%B3%D1%83-%D0%BE%D1%82%D0%BA%D1%80%D1%8B%D1%82%D1%8C-%D1%82%D0%B5%D1%80%D0%BC%D0%B8%D0%BD%D0%B0%D0%BB-%D0%B2-ubuntu)  
12. Админских прав у пользователя не будет, поэтому нужно (см. https://youtu.be/jZGHtuxpaP4?si=X6mA74Qdt00wUaw6):  
12.1. Ввести команду su  
12.2. Ввести пароль текущего пользователя  
12.3. Ввести команду usermod -aG sudo vboxuser  
12.4. Перезагрузить ОС, например, командой reboot  
13. Даже если настроить в VirtualBox двунаправленный буфер обмена, он работать не будет. Чтобы это исправить, нужно:  
13.1. Скачать образ https://download.virtualbox.org/virtualbox/6.1.2/VBoxGuestAdditions_6.1.2.iso  
13.2. Смонтировать образ, например, открыв его в папке, с помощью двойного клика  
13.3. Открыть терминал в папке смонтированного образа  
13.4. Выполнить команду sudo sh VBoxLinuxAdditions.run  
13.5. Перезагрузить ОС  
13.6. После этого на экране будут постоянно появляться странные артефакты, но по крайней мере заработает общий буфер обмена. После дополнительной пары перезагрузок артефакты могут пропасть.  


### Установить на него PostgreSQL 15 с дефолтными настройками
### Создать БД для тестов: выполнить pgbench -i postgres
### Запустить pgbench -c8 -P 6 -T 60 -U postgres postgres
### Применить параметры настройки PostgreSQL из прикрепленного к материалам занятия файла
### Протестировать заново
### Что изменилось и почему?
### Создать таблицу с текстовым полем и заполнить случайными или сгенерированными данным в размере 1млн строк
### Посмотреть размер файла с таблицей
### 5 раз обновить все строчки и добавить к каждой строчке любой символ
### Посмотреть количество мертвых строчек в таблице и когда последний раз приходил автовакуум
### Подождать некоторое время, проверяя, пришел ли автовакуум
### 5 раз обновить все строчки и добавить к каждой строчке любой символ
### Посмотреть размер файла с таблицей
### Отключить Автовакуум на конкретной таблице
### 10 раз обновить все строчки и добавить к каждой строчке любой символ
### Посмотреть размер файла с таблицей
### Объясните полученный результат
### Не забудьте включить автовакуум)
### Задание со *: Написать анонимную процедуру, в которой в цикле 10 раз обновятся все строчки в искомой таблице. Не забыть вывести номер шага цикла.
